<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>MEMENTO | Tu Vida en Semanas</title>

  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root { --accent: #0f172a; }
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
    
    body { 
      margin: 0; 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      overflow-x: hidden; 
      min-height: 100dvh;
      background-color: #fbfbfb;
    }

    /* Fondo Mesh Animado */
    .mesh-bg {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
      background: radial-gradient(circle at 0% 0%, #ffffff 0%, #f1f5f9 100%);
      overflow: hidden;
    }
    .blob {
      position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.5;
      animation: move 20s infinite alternate ease-in-out;
    }
    @keyframes move {
      from { transform: translate(-10%, -10%) scale(1); }
      to { transform: translate(20%, 20%) scale(1.2); }
    }

    /* Glassmorphism */
    .glass {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.04);
    }

    /* Animaciones */
    .reveal { animation: reveal 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes reveal {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .svg-rotate { animation: rotateSlow 80s linear infinite; }
    @keyframes rotateSlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Scroll */
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    
    /* Edad Marca de Agua */
    .age-watermark {
      position: absolute; font-size: 10rem; font-weight: 800; opacity: 0.04;
      line-height: 1; pointer-events: none; z-index: 0; right: -1rem; top: -1rem;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState, memo, useCallback } = React;

    const STORAGE_KEY = "memento_profile_v3";

    const THEMES = {
      minimal: { name: "Canvas", bg: "from-slate-50 to-white", accent: "bg-slate-900", hex: { past: "#1e293b", future: "#e2e8f0", current: "#3b82f6" } },
      ocean: { name: "Deep Ocean", bg: "from-blue-50 to-cyan-50", accent: "bg-blue-600", hex: { past: "#0284c7", future: "#e0f2fe", current: "#0ea5e9" } },
      sunset: { name: "Rose Sunset", bg: "from-orange-50 to-rose-50", accent: "bg-rose-500", hex: { past: "#e11d48", future: "#ffe4e6", current: "#fb7185" } },
      midnight: { name: "Midnight", bg: "bg-slate-950", accent: "bg-indigo-500", hex: { past: "#6366f1", future: "#1e293b", current: "#22d3ee" } }
    };

    const I18N = {
      es: {
        welcome: "Bienvenido", start: "Comenzar", name: "¬øC√≥mo te llamas?", birthdate: "¬øCu√°ndo naciste?",
        lived: "Semanas vividas", left: "Restantes", progress: "Progreso Vital",
        moodTitle: "¬øC√≥mo te sientes hoy?", settings: "Ajustes", theme: "Tema", design: "Dise√±o",
        cosmic: "Perspectiva C√≥smica", societal: "Contexto Global", nature: "Ciclos Naturales"
      },
      en: {
        welcome: "Welcome", start: "Get Started", name: "What's your name?", birthdate: "When were you born?",
        lived: "Weeks lived", left: "Remaining", progress: "Life Progress",
        moodTitle: "How are you today?", settings: "Settings", theme: "Theme", design: "Design",
        cosmic: "Cosmic Perspective", societal: "Global Context", nature: "Natural Cycles"
      }
    };

    // --- UTILS ---
    const fmt = (n) => Math.round(n).toLocaleString();

    // --- POOLS DE CONTENIDO DIN√ÅMICO ---
    const getDynamicInsights = (stats, lang) => {
      const isEs = lang === 'es';
      
      const cosmic = [
        isEs ? `Has viajado aproximadamente ${fmt(stats.kmAroundSun)} km alrededor del Sol.` : `You've traveled approx ${fmt(stats.kmAroundSun)} km around the Sun.`,
        isEs ? `La Tierra ha dado ${stats.orbits} vueltas completas contigo a bordo.` : `Earth has completed ${stats.orbits} full orbits with you on board.`,
        isEs ? `El Sistema Solar se ha desplazado ${fmt(stats.kmGalactic)} km por la galaxia desde tu nacimiento.` : `The Solar System has moved ${fmt(stats.kmGalactic)} km through the galaxy since your birth.`,
        isEs ? `Tu vida representa el ${stats.uniPct.toExponential(2)}% de la edad del Universo.` : `Your life represents ${stats.uniPct.toExponential(2)}% of the Universe's age.`
      ];

      const societal = [
        isEs ? `La poblaci√≥n mundial creci√≥ de ~${fmt(stats.popBirth)} a ~${fmt(stats.popNow)} durante tu vida.` : `World population grew from ~${fmt(stats.popBirth)} to ~${fmt(stats.popNow)} in your lifetime.`,
        isEs ? `Desde tu primer respiro, han nacido aprox. ${fmt(stats.birthsSince)} personas en el planeta.` : `Since your first breath, approx ${fmt(stats.birthsSince)} people have been born on Earth.`,
        isEs ? `Has vivido el surgimiento de tecnolog√≠as que tus ancestros considerar√≠an magia.` : `You've witnessed the rise of technologies your ancestors would call magic.`,
        isEs ? `Estad√≠sticamente, has compartido el mundo con ${fmt(stats.popNow)} historias diferentes.` : `Statistically, you've shared the world with ${fmt(stats.popNow)} different stories.`
      ];

      // Seleccionar uno aleatorio de cada pool
      const seed = new Date().getHours(); // Cambia cada hora o en cada carga si usamos Math.random
      return {
        cosmic: cosmic[Math.floor(Math.random() * cosmic.length)],
        societal: societal[Math.floor(Math.random() * societal.length)]
      };
    };

    function computeStats(birthISO) {
      if (!birthISO) return null;
      const birth = new Date(birthISO);
      const now = new Date();
      const diff = now - birth;
      const days = Math.floor(diff / 86400000);
      const weeks = Math.floor(days / 7);
      const totalWeeks = 4160;
      const years = days / 365.25;

      return {
        weeksLived: Math.min(weeks, totalWeeks),
        weeksRemaining: Math.max(0, totalWeeks - weeks),
        percentage: Math.min(100, Math.round((weeks / totalWeeks) * 100)),
        yearsLived: Math.floor(years),
        orbits: Math.floor(years),
        kmAroundSun: years * 940000000,
        kmGalactic: (diff / 1000) * 220,
        uniPct: (years / 13800000000) * 100,
        popBirth: 6900000000 + ((birth.getFullYear() - 2010) * 80000000),
        popNow: 8100000000,
        birthsSince: years * 140000000
      };
    }

    // --- COMPONENTES VISUALES ---

    const GridDesign = memo(({ stats, theme }) => (
      <div className="grid grid-cols-[repeat(52,1fr)] gap-[1px] w-full">
        {Array.from({ length: 4160 }).map((_, i) => (
          <div key={i} className="aspect-square rounded-[0.5px]" 
               style={{ backgroundColor: i < stats.weeksLived ? theme.hex.past : i === stats.weeksLived ? theme.hex.current : theme.hex.future }} />
        ))}
      </div>
    ));

    const SpiralDesign = memo(({ stats, theme }) => {
      const points = [];
      for (let i = 0; i < 4160; i++) {
        const t = i / 4159;
        const angle = t * Math.PI * 2 * 15;
        const radius = 10 + t * 140;
        const x = 175 + radius * Math.cos(angle);
        const y = 175 + radius * Math.sin(angle);
        const isCurrent = i === stats.weeksLived;
        points.push(<circle key={i} cx={x} cy={y} r={isCurrent ? 3 : 1.2} 
                    fill={isCurrent ? theme.hex.current : i < stats.weeksLived ? theme.hex.past : theme.hex.future} />);
      }
      return <svg viewBox="0 0 350 350" className="w-full h-auto svg-rotate">{points}</svg>;
    });

    const WaveDesign = memo(({ stats, theme }) => (
      <div className="flex items-end justify-center h-48 gap-[2px] w-full">
        {Array.from({ length: 52 }).map((_, col) => {
          const h = 30 + Math.sin(col * 0.25) * 30 + 40;
          const isPast = (col / 52) < (stats.percentage / 100);
          return (
            <div key={col} className="flex-1 rounded-t-full" 
                 style={{ height: `${h}%`, backgroundColor: isPast ? theme.hex.past : theme.hex.future }} />
          );
        })}
      </div>
    ));

    // --- APP PRINCIPAL ---

    function App() {
      const [profile, setProfile] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEY)) || null);
      const [showSettings, setShowSettings] = useState(false);
      const [showMood, setShowMood] = useState(false);
      
      const stats = useMemo(() => profile ? computeStats(profile.birthdate) : null, [profile]);
      const lang = profile?.prefs?.lang || 'es';
      const theme = profile?.prefs?.theme || 'minimal';
      const design = profile?.prefs?.design || 'grid';
      const t = (k) => I18N[lang][k];
      const tc = THEMES[theme];

      const insights = useMemo(() => stats ? getDynamicInsights(stats, lang) : null, [stats, lang]);

      useEffect(() => {
        if (profile) localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
        
        // Mood Trigger: Si es la primera vez que entra hoy
        if (profile && profile.lastEntry !== new Date().toDateString()) {
          setTimeout(() => setShowMood(true), 2000);
          setProfile(p => ({ ...p, lastEntry: new Date().toDateString() }));
        }
      }, [profile]);

      if (!profile) return <Setup onComplete={setProfile} />;

      return (
        <div className={`min-h-screen pb-24 transition-colors duration-700 ${theme === 'midnight' ? 'bg-slate-950 text-white' : 'text-slate-900'}`}>
          <div className="mesh-bg">
            <div className="blob" style={{ width: '500px', height: '500px', background: tc.hex.past, top: '-10%', left: '-10%' }}></div>
            <div className="blob" style={{ width: '400px', height: '400px', background: tc.hex.current, bottom: '-10%', right: '-10%', animationDelay: '-5s' }}></div>
          </div>

          <header className="px-6 pt-12 pb-6 flex justify-between items-center max-w-2xl mx-auto reveal">
            <div>
              <h1 className="text-3xl font-extrabold tracking-tight">Hola, {profile.name}</h1>
              <p className="opacity-50 text-sm font-medium">Memento Mori ‚Ä¢ {new Date().toLocaleDateString(lang, { day:'numeric', month:'long' })}</p>
            </div>
            <button onClick={() => setShowSettings(true)} className="p-3 glass rounded-2xl hover:scale-110 transition-transform">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            </button>
          </header>

          <main className="px-6 max-w-2xl mx-auto space-y-6">
            
            {/* Visualizaci√≥n Principal */}
            <div className={`glass rounded-[2.5rem] p-8 relative overflow-hidden reveal shadow-xl`}>
              <div className="age-watermark">{stats.yearsLived}</div>
              <div className="relative z-10 min-h-[300px] flex items-center justify-center">
                {design === 'grid' && <GridDesign stats={stats} theme={tc} />}
                {design === 'spiral' && <SpiralDesign stats={stats} theme={tc} />}
                {design === 'wave' && <WaveDesign stats={stats} theme={tc} />}
              </div>
              <div className="mt-8 flex justify-between items-end">
                <div>
                  <div className="text-4xl font-black">{fmt(stats.weeksLived)}</div>
                  <div className="text-[10px] uppercase tracking-[0.2em] font-bold opacity-40">{t('lived')}</div>
                </div>
                <div className="text-right">
                  <div className="text-4xl font-black opacity-20">{fmt(stats.weeksRemaining)}</div>
                  <div className="text-[10px] uppercase tracking-[0.2em] font-bold opacity-40">{t('left')}</div>
                </div>
              </div>
            </div>

            {/* Progreso */}
            <div className="glass rounded-3xl p-6 reveal" style={{animationDelay: '0.1s'}}>
               <div className="flex justify-between items-center mb-4 text-sm font-bold">
                  <span>{t('progress')}</span>
                  <span>{stats.percentage}%</span>
               </div>
               <div className="h-2.5 w-full bg-black/5 rounded-full overflow-hidden">
                  <div className={`h-full transition-all duration-1000 ${tc.accent}`} style={{ width: `${stats.percentage}%` }}></div>
               </div>
            </div>

            {/* Din√°micos */}
            <div className="grid grid-cols-1 gap-4 reveal" style={{animationDelay: '0.2s'}}>
              <InsightCard title={t('societal')} content={insights.societal} icon="üåç" theme={theme} />
              <InsightCard title={t('cosmic')} content={insights.cosmic} icon="‚ú®" theme={theme} />
            </div>

          </main>

          {/* Settings Modal */}
          {showSettings && (
            <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm p-4" onClick={() => setShowSettings(false)}>
              <div className={`w-full max-w-md glass rounded-[2.5rem] p-8 reveal`} onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-8">
                  <h2 className="text-2xl font-bold">{t('settings')}</h2>
                  <button onClick={() => setShowSettings(false)} className="p-2 opacity-50 hover:opacity-100"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>

                <div className="space-y-6">
                  <div>
                    <label className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-3 block">{t('language')}</label>
                    <div className="flex gap-2">
                       {['es', 'en'].map(l => (
                         <button key={l} onClick={() => setProfile({...profile, prefs: {...profile.prefs, lang: l}})} className={`flex-1 py-3 rounded-2xl font-bold border-2 transition-all ${lang === l ? 'border-blue-500 bg-blue-50 text-blue-600' : 'border-black/5'}`}>{l.toUpperCase()}</button>
                       ))}
                    </div>
                  </div>

                  <div>
                    <label className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-3 block">{t('theme')}</label>
                    <div className="grid grid-cols-2 gap-2">
                       {Object.keys(THEMES).map(k => (
                         <button key={k} onClick={() => setProfile({...profile, prefs: {...profile.prefs, theme: k}})} className={`py-3 rounded-2xl font-bold border-2 transition-all ${theme === k ? 'border-blue-500 bg-blue-50 text-blue-600' : 'border-black/5'}`}>{THEMES[k].name}</button>
                       ))}
                    </div>
                  </div>

                  <div>
                    <label className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-3 block">{t('design')}</label>
                    <div className="grid grid-cols-3 gap-2">
                       {['grid', 'spiral', 'wave'].map(d => (
                         <button key={d} onClick={() => setProfile({...profile, prefs: {...profile.prefs, design: d}})} className={`py-3 rounded-2xl font-bold border-2 transition-all capitalize ${design === d ? 'border-blue-500 bg-blue-50 text-blue-600' : 'border-black/5'}`}>{d}</button>
                       ))}
                    </div>
                  </div>
                </div>

                <button onClick={() => { localStorage.removeItem(STORAGE_KEY); window.location.reload(); }} className="w-full mt-10 py-4 bg-red-50 text-red-500 rounded-2xl font-bold">Borrar Datos</button>
              </div>
            </div>
          )}

          {/* Mood Modal */}
          {showMood && (
             <div className="fixed inset-0 z-[60] flex items-center justify-center p-6 bg-black/20 backdrop-blur-md">
                <div className="w-full max-w-sm glass rounded-[3rem] p-10 text-center reveal shadow-2xl">
                   <h3 className="text-2xl font-black mb-2">{t('moodTitle')}</h3>
                   <p className="text-slate-500 mb-8 text-sm">Un momento para conectar contigo.</p>
                   <div className="grid grid-cols-3 gap-4">
                      {['üòä','üòê','üòî','üî•','üåä','üò¥'].map(emoji => (
                         <button key={emoji} onClick={() => setShowMood(false)} className="text-4xl p-4 glass rounded-3xl hover:scale-110 transition-transform">{emoji}</button>
                      ))}
                   </div>
                   <button onClick={() => setShowMood(false)} className="mt-10 text-slate-400 font-bold text-sm">Omitir</button>
                </div>
             </div>
          )}
        </div>
      );
    }

    // --- SUB-COMPONENTE SETUP ---
    function Setup({ onComplete }) {
      const [step, setStep] = useState(0);
      const [data, setData] = useState({ name: '', birthdate: '', prefs: { lang: 'es', theme: 'minimal', design: 'grid' } });

      return (
        <div className="min-h-screen flex items-center justify-center p-6 bg-slate-50">
          <div className="w-full max-w-md glass p-10 rounded-[3rem] shadow-2xl text-center reveal">
            {step === 0 ? (
              <div className="reveal">
                <div className="w-20 h-20 bg-slate-900 rounded-3xl mx-auto mb-8 flex items-center justify-center text-white text-4xl font-black shadow-xl">M</div>
                <h1 className="text-4xl font-black mb-4 tracking-tight">Memento</h1>
                <p className="text-slate-500 mb-10 leading-relaxed text-lg">Tu vida es finita. Visual√≠zala para vivir con prop√≥sito.</p>
                <button onClick={() => setStep(1)} className="w-full py-5 bg-slate-900 text-white rounded-3xl font-bold shadow-lg shadow-slate-200 active:scale-95 transition-transform">Empezar</button>
              </div>
            ) : (
              <div className="reveal space-y-6 text-left">
                <h2 className="text-2xl font-black mb-8 text-center">Configura tu Perfil</h2>
                <div>
                  <label className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-2 block">Nombre</label>
                  <input className="w-full p-5 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej. Alex" onChange={e => setData({...data, name: e.target.value})} />
                </div>
                <div>
                  <label className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-2 block">Fecha de Nacimiento</label>
                  <input type="date" className="w-full p-5 bg-slate-100 rounded-2xl outline-none" onChange={e => setData({...data, birthdate: e.target.value})} />
                </div>
                <button onClick={() => data.name && data.birthdate && onComplete(data)} className="w-full py-5 bg-slate-900 text-white rounded-3xl font-bold shadow-xl disabled:opacity-20 mt-4" disabled={!data.name || !data.birthdate}>Finalizar</button>
              </div>
            )}
          </div>
        </div>
      );
    }

    function InsightCard({ title, content, icon, theme }) {
      return (
        <div className={`glass p-6 rounded-3xl flex items-start gap-4 ${theme === 'midnight' ? 'bg-white/5 border-white/10' : ''}`}>
          <div className="text-2xl p-3 glass rounded-2xl">{icon}</div>
          <div>
            <h4 className="text-[10px] uppercase font-black tracking-widest opacity-40 mb-1">{title}</h4>
            <p className="text-sm font-medium leading-relaxed opacity-80">{content}</p>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
