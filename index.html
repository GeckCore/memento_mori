<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>MEMENTO | Visualizador Vital</title>

  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  
  <style>
    /* --- CORE STYLES --- */
    :root { --glass-border: rgba(255, 255, 255, 0.1); }
    body { 
      font-family: 'Outfit', sans-serif; 
      margin: 0; padding: 0; overflow-x: hidden;
      background-color: #000; color: #fff;
      -webkit-tap-highlight-color: transparent;
    }

    /* --- ANIMATIONS --- */
    @keyframes float { 0%, 100% { transform: translateY(0px) scale(1); } 50% { transform: translateY(-20px) scale(1.05); } }
    @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes fade-in-up { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .animate-enter { animation: fade-in-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    .animate-float { animation: float 15s ease-in-out infinite; }
    .animate-spin-slow { animation: spin-slow 60s linear infinite; }

    /* --- BACKGROUND BLOBS --- */
    .blob-cont { position: fixed; inset: 0; z-index: -1; overflow: hidden; pointer-events: none; }
    .blob { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.6; }

    /* --- GLASSMORPHISM --- */
    .glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .glass-strong {
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-top: 1px solid rgba(255,255,255,0.15);
    }

    /* --- UTILS --- */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .text-glow { text-shadow: 0 0 20px rgba(255,255,255,0.3); }
    
    /* Input Styling */
    input[type="date"] { color-scheme: dark; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState, memo } = React;

    // --- CONFIGURACI√ìN ---
    const STORAGE_KEY = "memento_pro_v5";
    
    const THEMES = {
      neon: { name: "Neon Night", bg1: "#4f46e5", bg2: "#c026d3", accent: "#22d3ee", hex: { past: "#312e81", future: "#1e1b4b", current: "#22d3ee" } },
      sunset: { name: "Solar Flare", bg1: "#ea580c", bg2: "#db2777", accent: "#fb923c", hex: { past: "#9f1239", future: "#450a0a", current: "#fb923c" } },
      forest: { name: "Deep Zen", bg1: "#059669", bg2: "#0f766e", accent: "#34d399", hex: { past: "#064e3b", future: "#022c22", current: "#34d399" } },
      mono: { name: "Obsidian", bg1: "#333333", bg2: "#000000", accent: "#ffffff", hex: { past: "#525252", future: "#171717", current: "#ffffff" } }
    };

    const I18N = {
      es: {
        welcome: "Memento Mori", subtitle: "Tu tiempo es finito. √ösalo bien.",
        setup_name: "¬øC√≥mo te llamas?", setup_date: "Fecha de nacimiento", btn_start: "Comenzar Viaje",
        weeks_lived: "Semanas vividas", weeks_left: "Semanas restantes",
        life_progress: "Progreso Vital", statistics: "Estad√≠sticas en tiempo real",
        stat_heart: "Latidos", stat_breaths: "Respiraciones", stat_sleep: "Horas Durmiendo",
        ctx_global: "Contexto Global", ctx_cosmic: "Perspectiva C√≥smica",
        settings: "Ajustes", theme: "Tema Visual", design: "Dise√±o del Mapa", lang: "Idioma",
        btn_reset: "Borrar Datos", close: "Cerrar"
      },
      en: {
        welcome: "Memento Mori", subtitle: "Your time is finite. Use it well.",
        setup_name: "What is your name?", setup_date: "Date of birth", btn_start: "Start Journey",
        weeks_lived: "Weeks lived", weeks_left: "Weeks left",
        life_progress: "Life Progress", statistics: "Real-time Statistics",
        stat_heart: "Heartbeats", stat_breaths: "Breaths", stat_sleep: "Hours Slept",
        ctx_global: "Global Context", ctx_cosmic: "Cosmic Perspective",
        settings: "Settings", theme: "Visual Theme", design: "Map Design", lang: "Language",
        btn_reset: "Reset Data", close: "Close"
      }
    };

    // --- LOGICA MATEM√ÅTICA ---
    const fmt = (n) => Math.round(n).toLocaleString();
    
    // Pool de datos curiosos (Se regenera al cargar)
    const getInsights = (stats, lang) => {
      const isEs = lang === 'es';
      return {
        societal: isEs 
          ? `Desde que naciste, la poblaci√≥n mundial creci√≥ de ~${fmt(stats.popBirth)} a ~${fmt(stats.popNow)}. Has compartido el planeta con ${fmt(stats.birthsSince)} nuevas almas.` 
          : `Since birth, world population grew from ~${fmt(stats.popBirth)} to ~${fmt(stats.popNow)}. You've shared the planet with ${fmt(stats.birthsSince)} new souls.`,
        cosmic: isEs 
          ? `Has viajado ${fmt(stats.kmSun)} km alrededor del Sol. A nivel gal√°ctico, el Sistema Solar se ha movido ${fmt(stats.kmGalactic)} km desde tu primer respiro.` 
          : `You've traveled ${fmt(stats.kmSun)} km around the Sun. Galactically, the Solar System moved ${fmt(stats.kmGalactic)} km since your first breath.`
      };
    };

    function calculateStats(dob) {
      if (!dob) return null;
      const birth = new Date(dob);
      const now = new Date();
      const diff = now - birth;
      
      const years = diff / (1000 * 60 * 60 * 24 * 365.25);
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const weeks = Math.floor(days / 7);
      const totalWeeks = 4160; // 80 a√±os

      return {
        yearsFloat: years,
        yearsInt: Math.floor(years),
        weeksLived: Math.min(weeks, totalWeeks),
        weeksTotal: totalWeeks,
        weeksLeft: Math.max(0, totalWeeks - weeks),
        percentage: Math.min(100, (weeks / totalWeeks) * 100).toFixed(1),
        days,
        // Stats ricas
        heartbeats: days * 100000, // ~100k al dia
        breaths: days * 23000, // ~23k al dia
        sleep: days * 8,
        popBirth: 6900000000 + ((birth.getFullYear() - 2010) * 80000000),
        popNow: 8100000000,
        birthsSince: years * 140000000,
        kmSun: years * 940000000,
        kmGalactic: (diff / 1000) * 220
      };
    }

    // --- VISUALIZADORES (SVG PURO) ---
    const Visualizer = memo(({ type, stats, theme }) => {
      const { weeksLived, weeksTotal } = stats;
      const colCurrent = theme.hex.current;
      const colPast = theme.hex.past;
      const colFuture = theme.hex.future;

      // 1. GRID (Cuadr√≠cula Cl√°sica)
      if (type === 'grid') {
        // Usamos CSS Grid nativo para rendimiento
        return (
          <div className="w-full grid grid-cols-[repeat(52,1fr)] gap-[1px]">
            {Array.from({ length: weeksTotal }).map((_, i) => (
              <div key={i} className="aspect-square rounded-[0.5px]" 
                   style={{ backgroundColor: i < weeksLived ? colPast : i === weeksLived ? colCurrent : colFuture, 
                            boxShadow: i === weeksLived ? `0 0 10px ${colCurrent}` : 'none' }} />
            ))}
          </div>
        );
      }

      // 2. SPIRAL (Espiral de Arqu√≠medes)
      if (type === 'spiral') {
        const points = [];
        const centerX = 200, centerY = 200;
        const revolutions = 20;
        // Solo renderizamos puntos, no lineas, para el look de "semanas"
        for (let i = 0; i < weeksTotal; i += 2) { // Optimizacion: saltar de 2 en 2 para m√≥viles
          const t = i / weeksTotal; 
          const angle = t * Math.PI * 2 * revolutions;
          const radius = 10 + (t * 180); // Radio crece
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);
          
          points.push(
            <circle key={i} cx={x} cy={y} r={i === weeksLived ? 4 : 1.5} 
                    fill={i < weeksLived ? colPast : i === weeksLived ? colCurrent : colFuture}
                    className={i === weeksLived ? "animate-pulse" : ""} />
          );
        }
        return <svg viewBox="0 0 400 400" className="w-full h-auto animate-spin-slow">{points}</svg>;
      }

      // 3. STARS (Constelaci√≥n Aleatoria pero Determinista)
      if (type === 'stars') {
        // Usamos un generador lineal congruente para que las estrellas no "bailen" al recargar
        let seed = 1234;
        const random = () => { seed = (seed * 16807) % 2147483647; return (seed - 1) / 2147483646; };
        
        const stars = [];
        for (let i = 0; i < 2000; i++) { // 2000 puntos representativos
          const x = random() * 400;
          const y = random() * 400;
          // Distancia al centro para efecto vi√±eta opcional, pero plano es mejor aqui
          const isLived = (i / 2000) < (weeksLived / weeksTotal);
          
          stars.push(
            <circle key={i} cx={x} cy={y} r={random() * 1.5 + 0.5} 
                    fill={isLived ? colPast : colFuture} opacity={random() * 0.8 + 0.2} />
          );
        }
        // El punto "actual" es una estrella brillante en el centro
        return (
          <svg viewBox="0 0 400 400" className="w-full h-auto">
            {stars}
            <circle cx="200" cy="200" r="6" fill={colCurrent} className="animate-pulse">
              <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite" />
            </circle>
          </svg>
        );
      }

      return null;
    });

    // --- COMPONENTE PRINCIPAL ---
    function App() {
      const [profile, setProfile] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEY)));
      const [showSettings, setShowSettings] = useState(false);
      
      const stats = useMemo(() => profile ? calculateStats(profile.dob) : null, [profile?.dob]);
      const lang = profile?.prefs?.lang || 'es';
      const themeKey = profile?.prefs?.theme || 'neon';
      const design = profile?.prefs?.design || 'grid';
      
      const theme = THEMES[themeKey];
      const txt = I18N[lang];

      // Insights din√°micos
      const insights = useMemo(() => stats ? getInsights(stats, lang) : null, [stats, lang]);

      useEffect(() => {
        if (profile) localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
      }, [profile]);

      if (!profile) return <Onboarding onComplete={setProfile} theme={THEMES.neon} lang={lang} />;

      return (
        <div className="min-h-screen relative text-white transition-colors duration-700 overflow-hidden">
          {/* BACKGROUND SYSTEM */}
          <div className="blob-cont">
            <div className="blob animate-float" style={{ width: '80vw', height: '80vw', background: theme.bg1, top: '-20%', left: '-20%' }} />
            <div className="blob animate-float" style={{ width: '80vw', height: '80vw', background: theme.bg2, bottom: '-20%', right: '-20%', animationDelay: '-5s' }} />
            <div className="absolute inset-0 bg-black/40 backdrop-blur-[30px]" /> {/* Noise/Blur overlay */}
          </div>

          {/* HEADER */}
          <header className="relative z-10 px-6 pt-12 pb-4 flex justify-between items-center max-w-lg mx-auto animate-enter">
            <div>
              <h1 className="text-3xl font-black tracking-tighter text-glow">{profile.name}</h1>
              <p className="text-xs font-bold uppercase tracking-widest opacity-60">{stats.yearsInt} A√±os ‚Ä¢ {design.toUpperCase()}</p>
            </div>
            <button onClick={() => setShowSettings(true)} className="p-3 glass rounded-full active:scale-95 transition-transform">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
            </button>
          </header>

          <main className="relative z-10 px-4 pb-24 max-w-lg mx-auto space-y-6">
            
            {/* TARJETA PRINCIPAL (VISUALIZADOR) */}
            <div className="glass-strong rounded-[2.5rem] p-6 relative overflow-hidden shadow-2xl animate-enter" style={{animationDelay: '0.1s'}}>
              {/* Edad de fondo */}
              <div className="absolute -top-6 -right-6 text-[10rem] font-black opacity-[0.03] select-none pointer-events-none">
                {stats.yearsInt}
              </div>
              
              <div className="relative z-10 py-4 min-h-[350px] flex items-center justify-center">
                <Visualizer type={design} stats={stats} theme={theme} />
              </div>

              {/* Data Footer */}
              <div className="flex justify-between items-end border-t border-white/10 pt-4 mt-2">
                <div>
                  <div className="text-3xl font-bold font-mono">{fmt(stats.weeksLived)}</div>
                  <div className="text-[10px] uppercase tracking-widest opacity-50">{txt.weeks_lived}</div>
                </div>
                <div className="text-right">
                  <div className="text-3xl font-bold font-mono text-white/40">{fmt(stats.weeksLeft)}</div>
                  <div className="text-[10px] uppercase tracking-widest opacity-50">{txt.weeks_left}</div>
                </div>
              </div>
            </div>

            {/* BARRA DE PROGRESO */}
            <div className="glass rounded-3xl p-6 animate-enter" style={{animationDelay: '0.2s'}}>
              <div className="flex justify-between items-center mb-3">
                <span className="text-xs font-bold uppercase tracking-widest opacity-60">{txt.life_progress}</span>
                <span className="text-xl font-black" style={{color: theme.accent}}>{stats.percentage}%</span>
              </div>
              <div className="w-full h-3 bg-white/5 rounded-full overflow-hidden">
                <div className="h-full transition-all duration-1000 ease-out shadow-[0_0_15px_rgba(255,255,255,0.5)]" 
                     style={{ width: `${stats.percentage}%`, backgroundColor: theme.accent }} />
              </div>
              <p className="mt-4 text-sm text-center opacity-70 leading-relaxed">
                {lang === 'es' 
                  ? `Has vivido ${fmt(stats.days)} d√≠as. Te quedan aprox. ${fmt(stats.weeksLeft)} semanas.`
                  : `You have lived ${fmt(stats.days)} days. Approx ${fmt(stats.weeksLeft)} weeks remain.`}
              </p>
            </div>

            {/* ESTAD√çSTICAS RICAS */}
            <div className="grid grid-cols-2 gap-3 animate-enter" style={{animationDelay: '0.3s'}}>
              <StatBox icon="‚ù§Ô∏è" label={txt.stat_heart} val={fmt(stats.heartbeats)} />
              <StatBox icon="üå¨Ô∏è" label={txt.stat_breaths} val={fmt(stats.breaths)} />
              <StatBox icon="üò¥" label={txt.stat_sleep} val={fmt(stats.sleep) + "h"} />
              <StatBox icon="üåç" label="Orbitas" val={stats.yearsFloat.toFixed(2)} />
            </div>

            {/* INSIGHTS */}
            <div className="space-y-3 animate-enter" style={{animationDelay: '0.4s'}}>
              <InsightCard title={txt.ctx_global} text={insights.societal} theme={theme} />
              <InsightCard title={txt.ctx_cosmic} text={insights.cosmic} theme={theme} />
            </div>

          </main>

          {/* SETTINGS MODAL */}
          {showSettings && (
            <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-enter">
              <div className="w-full max-w-md bg-[#111] border border-white/10 rounded-[2.5rem] p-8 shadow-2xl max-h-[85vh] overflow-y-auto hide-scrollbar">
                <div className="flex justify-between items-center mb-8">
                  <h2 className="text-2xl font-bold">{txt.settings}</h2>
                  <button onClick={() => setShowSettings(false)} className="p-2 opacity-50"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                </div>
                
                <div className="space-y-8">
                  <Section title={txt.lang}>
                    <div className="flex gap-2">
                      {['es', 'en'].map(l => (
                        <button key={l} onClick={() => setProfile({...profile, prefs: {...profile.prefs, lang: l}})} className={`flex-1 py-3 rounded-xl border font-bold transition-all ${lang === l ? 'bg-white text-black border-white' : 'border-white/20 text-white/50'}`}>{l.toUpperCase()}</button>
                      ))}
                    </div>
                  </Section>

                  <Section title={txt.theme}>
                    <div className="grid grid-cols-2 gap-2">
                      {Object.keys(THEMES).map(k => (
                        <button key={k} onClick={() => setProfile({...profile, prefs: {...profile.prefs, theme: k}})} className={`py-3 rounded-xl border text-sm font-bold transition-all ${themeKey === k ? 'bg-white text-black border-white' : 'border-white/20 text-white/50'}`}>
                          {THEMES[k].name}
                        </button>
                      ))}
                    </div>
                  </Section>

                  <Section title={txt.design}>
                    <div className="grid grid-cols-3 gap-2">
                      {['grid', 'spiral', 'stars'].map(d => (
                        <button key={d} onClick={() => setProfile({...profile, prefs: {...profile.prefs, design: d}})} className={`py-3 rounded-xl border text-xs uppercase font-bold transition-all ${design === d ? 'bg-white text-black border-white' : 'border-white/20 text-white/50'}`}>
                          {d}
                        </button>
                      ))}
                    </div>
                  </Section>

                  <button onClick={() => { localStorage.removeItem(STORAGE_KEY); window.location.reload(); }} className="w-full py-4 text-red-400 font-bold bg-red-500/10 rounded-xl mt-4">
                    {txt.btn_reset}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // --- COMPONENTES UI ---
    
    function Onboarding({ onComplete, theme, lang }) {
      const [name, setName] = useState("");
      const [dob, setDob] = useState("");
      
      return (
        <div className="min-h-screen flex items-center justify-center p-6 bg-black relative text-white overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,_#333_0%,_#000_100%)] z-0" />
          <div className="relative z-10 w-full max-w-sm text-center animate-enter">
             <div className="w-20 h-20 bg-white text-black rounded-3xl mx-auto mb-6 flex items-center justify-center text-4xl font-black shadow-[0_0_30px_rgba(255,255,255,0.3)]">M</div>
             <h1 className="text-4xl font-bold mb-2 tracking-tight">Memento</h1>
             <p className="text-white/50 mb-10">Visualiza tu vida. Gana perspectiva.</p>
             
             <div className="space-y-4 text-left glass p-8 rounded-[2rem]">
               <div>
                 <label className="text-[10px] uppercase font-bold tracking-widest opacity-50 ml-1">Nombre</label>
                 <input className="w-full bg-white/5 border border-white/10 p-4 rounded-xl mt-2 text-white outline-none focus:border-white/50 transition-colors" 
                        placeholder="Tu nombre..." onChange={e => setName(e.target.value)} />
               </div>
               <div>
                 <label className="text-[10px] uppercase font-bold tracking-widest opacity-50 ml-1">Nacimiento</label>
                 <input type="date" className="w-full bg-white/5 border border-white/10 p-4 rounded-xl mt-2 text-white outline-none focus:border-white/50 transition-colors" 
                        onChange={e => setDob(e.target.value)} />
               </div>
               <button onClick={() => name && dob && onComplete({ name, dob, prefs: { theme: 'neon', lang: 'es', design: 'grid' } })} 
                       disabled={!name || !dob}
                       className="w-full py-4 bg-white text-black font-bold rounded-xl shadow-xl mt-4 active:scale-95 transition-all disabled:opacity-50">
                 Comenzar
               </button>
             </div>
          </div>
        </div>
      );
    }

    const StatBox = ({ icon, label, val }) => (
      <div className="glass p-4 rounded-2xl">
        <div className="text-xl mb-1">{icon}</div>
        <div className="text-lg font-bold leading-none">{val}</div>
        <div className="text-[9px] uppercase tracking-wider opacity-50 mt-1">{label}</div>
      </div>
    );

    const InsightCard = ({ title, text, theme }) => (
      <div className="glass p-5 rounded-2xl border-l-4" style={{borderLeftColor: theme.accent}}>
        <h4 className="text-[10px] uppercase font-bold tracking-widest opacity-50 mb-2">{title}</h4>
        <p className="text-sm opacity-90 leading-relaxed font-light">{text}</p>
      </div>
    );

    const Section = ({ title, children }) => (
      <div>
        <h3 className="text-[10px] uppercase font-bold tracking-widest opacity-40 mb-3">{title}</h3>
        {children}
      </div>
    );

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
