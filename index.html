<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>MEMENTO | Life Galaxy</title>

  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  
  <style>
    :root { --glass: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1); }
    body { 
      font-family: 'Space Grotesk', sans-serif; 
      margin: 0; padding: 0; 
      background-color: #000; color: #fff;
      overflow-x: hidden; -webkit-tap-highlight-color: transparent;
    }

    /* --- ANIMATIONS --- */
    @keyframes galaxy-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes pulse-star { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }
    @keyframes float-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

    .anim-galaxy { animation: galaxy-spin 120s linear infinite; }
    .anim-float { animation: float-slow 8s ease-in-out infinite; }
    .anim-scan { position: absolute; left:0; right:0; height: 50px; background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.1), transparent); animation: scan 3s linear infinite; pointer-events: none; }

    /* --- UI UTILS --- */
    .glass-panel {
      background: var(--glass);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    
    /* Input Date Dark Mode Fix */
    input[type="date"] { background: transparent; color: white; color-scheme: dark; }
    
    .glow-text { text-shadow: 0 0 20px currentColor; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState, memo } = React;
    const STORAGE_KEY = "memento_galaxy_v8";

    // --- TEMAS (Configuraci√≥n de colores robusta) ---
    const THEMES = {
      nebula: { name: "Nebula", bg1: "#6366f1", bg2: "#a855f7", accent: "#c084fc", hex: { past: "#312e81", future: "#1e1b4b", current: "#c084fc" } },
      mars: { name: "Mars", bg1: "#dc2626", bg2: "#991b1b", accent: "#f87171", hex: { past: "#7f1d1d", future: "#450a0a", current: "#fca5a5" } },
      aurora: { name: "Aurora", bg1: "#10b981", bg2: "#0f766e", accent: "#34d399", hex: { past: "#064e3b", future: "#022c22", current: "#34d399" } },
      midnight: { name: "Midnight", bg1: "#1e293b", bg2: "#0f172a", accent: "#38bdf8", hex: { past: "#1e293b", future: "#020617", current: "#38bdf8" } },
      gold: { name: "Lux", bg1: "#d97706", bg2: "#78350f", accent: "#fbbf24", hex: { past: "#92400e", future: "#2a1b0a", current: "#fbbf24" } },
      birthday: { name: "Party", bg1: "#db2777", bg2: "#7c3aed", accent: "#f472b6", hex: { past: "#be185d", future: "#312e81", current: "#f472b6" } }
    };

    const I18N = {
      es: {
        welcome: "MEMENTO", sub: "El tiempo es arte.",
        setup_name: "¬øTu nombre?", setup_dob: "Nacimiento", btn_start: "Inicializar Sistema",
        weeks_lived: "Vivido", weeks_left: "Futuro",
        progress: "Progreso Vital", stats: "Biometr√≠a",
        heart: "Latidos", breath: "Aires", sleep: "Sue√±o", orbit: "√ìrbitas",
        global: "Contexto Global", cosmic: "Datos C√≥smicos",
        settings: "Configuraci√≥n", theme: "Apariencia", design: "Visualizaci√≥n", lang: "Idioma", reset: "Reiniciar",
        bday_title: "¬°Feliz Cumplea√±os,", bday_msg: "Una vuelta m√°s al sol completada. El universo celebra tu existencia.",
        quote: "Memento Mori: Recuerda que has de vivir."
      },
      en: {
        welcome: "MEMENTO", sub: "Time is art.",
        setup_name: "Your Name?", setup_dob: "Birthdate", btn_start: "Initialize System",
        weeks_lived: "Lived", weeks_left: "Future",
        progress: "Life Progress", stats: "Biometrics",
        heart: "Heartbeats", breath: "Breaths", sleep: "Sleep", orbit: "Orbits",
        global: "Global Context", cosmic: "Cosmic Data",
        settings: "Settings", theme: "Appearance", design: "Visualization", lang: "Language", reset: "Reset",
        bday_title: "Happy Birthday,", bday_msg: "Another trip around the sun completed. The universe celebrates you.",
        quote: "Memento Mori: Remember to live."
      }
    };

    // --- UTILS ---
    const fmt = (n) => Math.round(n).toLocaleString();
    const isBirthday = (dob) => {
      const d = new Date(dob); const n = new Date();
      return d.getDate() === n.getDate() && d.getMonth() === n.getMonth();
    };

    function calcStats(dob) {
      const start = new Date(dob);
      const now = new Date();
      const ms = now - start;
      const days = ms / 86400000;
      const weeks = Math.floor(days / 7);
      const total = 4160; // 80y

      return {
        lived: Math.min(weeks, total),
        total,
        left: Math.max(0, total - weeks),
        pct: Math.min(100, (weeks / total) * 100).toFixed(1),
        years: Math.floor(days / 365.25),
        heart: Math.floor(days * 105000),
        breath: Math.floor(days * 23000),
        sleep: Math.floor(days * 8),
        orbits: (days / 365.25).toFixed(2),
        popStart: 6900000000 + ((start.getFullYear() - 2010) * 80000000),
        popNow: 8100000000,
        kmSun: (days / 365.25) * 940000000
      };
    }

    // --- VISUALIZADORES ---

    // 1. GALAXY SPIRAL (Restaurado y Optimizado)
    const GalaxyVisualizer = memo(({ stats, theme }) => {
      const { lived, total } = stats;
      const points = useMemo(() => {
        const arr = [];
        const cx = 200, cy = 200;
        // Creamos una galaxia espiral logar√≠tmica
        for (let i = 0; i < total; i++) {
           // Distribuir puntos a lo largo de brazos espirales
           const armOffset = (i % 3) * (Math.PI * 2 / 3); // 3 Brazos
           const t = i / total; 
           const dist = 10 + (t * 180); // Radio expandi√©ndose
           const angle = (t * Math.PI * 10) + armOffset; // Rotaci√≥n espiral
           
           // A√±adir "ruido" aleatorio para naturalidad (pero determinista basado en i)
           const noise = (Math.sin(i) * 10); 
           const x = cx + (dist + noise) * Math.cos(angle);
           const y = cy + (dist + noise) * Math.sin(angle);
           
           // Solo renderizamos si es visible o significativo para ahorrar DOM en animaciones complejas?
           // No, SVG aguanta 4000 nodos si no los animamos individualmente.
           // La animaci√≥n ser√° un <g> rotando todo el conjunto.
           arr.push({ x, y, id: i });
        }
        return arr;
      }, [total]);

      return (
        <svg viewBox="0 0 400 400" className="w-full h-auto">
           {/* Fondo Glow */}
           <defs>
             <radialGradient id="centerGlow">
               <stop offset="0%" stopColor={theme.accent} stopOpacity="0.5"/>
               <stop offset="100%" stopColor={theme.accent} stopOpacity="0"/>
             </radialGradient>
           </defs>
           <circle cx="200" cy="200" r="60" fill="url(#centerGlow)" />
           
           {/* Grupo Rotatorio */}
           <g className="anim-galaxy" style={{transformOrigin: '200px 200px'}}>
             {points.map((p) => {
               const isLived = p.id < lived;
               const isCurrent = p.id === lived;
               const color = isLived ? theme.hex.past : isCurrent ? theme.hex.current : theme.hex.future;
               const opacity = isLived ? 0.8 : 0.3;
               const r = isCurrent ? 4 : isLived ? 1.5 : 1;
               
               return (
                 <circle key={p.id} cx={p.x} cy={p.y} r={r} fill={color} opacity={opacity} 
                         className={isCurrent ? "anim-pulse" : ""} />
               )
             })}
           </g>
           
           {/* Indicador central */}
           <circle cx="200" cy="200" r="3" fill="#fff" />
        </svg>
      );
    });

    // 2. GRID PRO (Con d√©cadas)
    const GridVisualizer = memo(({ stats, theme }) => {
      const { lived, total } = stats;
      return (
        <div className="relative w-full h-full overflow-hidden rounded-xl">
           <div className="anim-scan"></div>
           <div className="grid grid-cols-[repeat(52,1fr)] gap-[1px]">
             {Array.from({length: total}).map((_, i) => {
               const isDecade = (i+1) % 520 === 0;
               const isCurrent = i === lived;
               return (
                 <div key={i} 
                      className={`aspect-square rounded-[0.5px] transition-colors duration-300 ${isDecade ? 'mb-1' : ''}`}
                      style={{
                        backgroundColor: i < lived ? theme.hex.past : isCurrent ? theme.hex.current : theme.hex.future,
                        opacity: i < lived ? 0.6 : isCurrent ? 1 : 0.2,
                        boxShadow: isCurrent ? `0 0 10px ${theme.hex.current}` : 'none'
                      }} />
               )
             })}
           </div>
        </div>
      );
    });

    // --- APP ---
    function App() {
      const [user, setUser] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEY)));
      const [settings, setSettings] = useState(false);
      
      const lang = user?.lang || 'es';
      const txt = I18N[lang];
      const stats = useMemo(() => user ? calcStats(user.dob) : null, [user]);
      const bday = user && isBirthday(user.dob);
      
      // Fix Theme Logic: Use user theme unless Birthday (and user hasn't overridden birthday theme preference? let's keep simple)
      const themeKey = bday ? 'birthday' : (user?.theme || 'nebula');
      const theme = THEMES[themeKey];
      const design = user?.design || 'galaxy';

      useEffect(() => {
        if (user) localStorage.setItem(STORAGE_KEY, JSON.stringify(user));
      }, [user]);

      // Confetti
      useEffect(() => {
        if (bday) {
           const end = Date.now() + 3000;
           const colors = [theme.hex.current, '#ffffff'];
           (function frame() {
             confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors });
             confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors });
             if (Date.now() < end) requestAnimationFrame(frame);
           }());
        }
      }, [bday]);

      if (!user) return <Setup onSave={setUser} t={txt} />;

      // Insights din√°micos
      const globalTxt = lang==='es' ? `De ${fmt(stats.popStart)} a ${fmt(stats.popNow)} humanos.` : `From ${fmt(stats.popStart)} to ${fmt(stats.popNow)} humans.`;
      const cosmicTxt = lang==='es' ? `Has recorrido ${fmt(stats.kmSun)} km orbitando el Sol.` : `You traveled ${fmt(stats.kmSun)} km around Sun.`;

      return (
        <div className="min-h-screen relative text-white selection:bg-white/20 transition-colors duration-1000 overflow-hidden bg-black">
          
          {/* FONDOS AMBIENTALES */}
          <div className="fixed inset-0 z-0">
             <div className="absolute top-[-20%] left-[-20%] w-[90vw] h-[90vw] rounded-full blur-[120px] opacity-40 animate-float" style={{background: theme.bg1}}></div>
             <div className="absolute bottom-[-20%] right-[-20%] w-[90vw] h-[90vw] rounded-full blur-[120px] opacity-40 animate-float" style={{background: theme.bg2, animationDelay: '-10s'}}></div>
             <div className="absolute inset-0 bg-black/40 backdrop-blur-[50px]"></div>
          </div>

          <div className="relative z-10 max-w-lg mx-auto px-6 pb-20 pt-10 min-h-screen flex flex-col">
            
            {/* HEADER */}
            <header className="flex justify-between items-center mb-8">
               <div>
                 <h1 className="text-3xl font-bold tracking-tighter drop-shadow-xl">{user.name}</h1>
                 <p className="text-xs font-bold uppercase tracking-[0.2em] opacity-60 flex items-center gap-2">
                   {stats.years} A√±os <span className="w-1 h-1 bg-white rounded-full"></span> {bday ? "üéÇ" : "MEMENTO"}
                 </p>
               </div>
               <button onClick={()=>setSettings(true)} className="w-10 h-10 glass-panel rounded-full flex items-center justify-center hover:bg-white/10 active:scale-95 transition-all">
                 <svg className="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
               </button>
            </header>

            {/* MAIN CARD */}
            <div className="glass-panel rounded-[2rem] p-1 relative overflow-hidden shadow-2xl mb-6 group">
               {/* Visualizador */}
               <div className="bg-black/20 rounded-[1.8rem] p-4 min-h-[350px] flex items-center justify-center relative overflow-hidden">
                  <div className="absolute inset-0 opacity-10 pointer-events-none text-[15rem] font-bold flex items-center justify-center select-none" style={{color: theme.accent}}>
                    {stats.years}
                  </div>
                  <div className="w-full relative z-10">
                    {design === 'galaxy' ? <GalaxyVisualizer stats={stats} theme={theme} /> : <GridVisualizer stats={stats} theme={theme} />}
                  </div>
               </div>

               {/* Footer Card */}
               <div className="px-6 py-4 flex justify-between items-end">
                  <div>
                    <div className="text-3xl font-bold tracking-tighter glow-text" style={{color: theme.hex.current}}>{fmt(stats.lived)}</div>
                    <div className="text-[10px] uppercase font-bold tracking-widest opacity-40">{txt.weeks_lived}</div>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold tracking-tighter opacity-30">{fmt(stats.left)}</div>
                    <div className="text-[10px] uppercase font-bold tracking-widest opacity-30">{txt.weeks_left}</div>
                  </div>
               </div>
            </div>

            {/* BDAY MESSAGE */}
            {bday && (
              <div className="glass-panel p-6 rounded-2xl mb-6 border border-yellow-500/30 bg-gradient-to-r from-pink-500/10 to-yellow-500/10">
                 <h2 className="text-lg font-bold text-yellow-300 mb-1">üéâ {txt.bday_title} {user.name}</h2>
                 <p className="text-sm opacity-80">{txt.bday_msg}</p>
              </div>
            )}

            {/* PROGRESS BAR */}
            <div className="glass-panel rounded-2xl p-5 mb-6">
               <div className="flex justify-between items-center mb-3">
                 <span className="text-xs font-bold uppercase tracking-widest opacity-50">{txt.progress}</span>
                 <span className="text-lg font-bold">{stats.pct}%</span>
               </div>
               <div className="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                 <div className="h-full transition-all duration-1000 shadow-[0_0_15px_currentColor]" 
                      style={{width:`${stats.pct}%`, backgroundColor: theme.accent, color: theme.accent}}></div>
               </div>
            </div>

            {/* STATS GRID */}
            <div className="grid grid-cols-2 gap-3 mb-6">
              <StatCard icon="‚ù§Ô∏è" val={fmt(stats.heart)} label={txt.heart} />
              <StatCard icon="üå¨Ô∏è" val={fmt(stats.breath)} label={txt.breath} />
              <StatCard icon="üò¥" val={fmt(stats.sleep)+"h"} label={txt.sleep} />
              <StatCard icon="ü™ê" val={stats.orbits} label={txt.orbit} />
            </div>

            {/* CONTEXT */}
            <div className="space-y-3 opacity-80">
               <ContextCard title={txt.global} text={globalTxt} theme={theme} />
               <ContextCard title={txt.cosmic} text={cosmicTxt} theme={theme} />
            </div>

          </div>

          {/* SETTINGS MODAL */}
          {settings && (
            <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-xl p-4 animate-[float-slow_0.5s_ease-out]" onClick={()=>setSettings(false)}>
               <div className="w-full max-w-md bg-[#0a0a0a] border border-white/10 rounded-[2rem] p-8 shadow-2xl max-h-[85vh] overflow-y-auto hide-scrollbar" onClick={e=>e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-8">
                    <h2 className="text-xl font-bold tracking-widest uppercase">{txt.settings}</h2>
                    <button onClick={()=>setSettings(false)} className="opacity-50 text-xl">‚úï</button>
                  </div>
                  
                  <SettingSection title={txt.lang}>
                    <div className="flex gap-2">
                       {['es','en'].map(l => (
                         <button key={l} onClick={()=>setUser({...user, lang:l})} className={`flex-1 py-3 rounded-xl border text-sm font-bold transition-all ${user.lang===l?'bg-white text-black border-white':'border-white/10 text-white/40'}`}>{l.toUpperCase()}</button>
                       ))}
                    </div>
                  </SettingSection>

                  <SettingSection title={txt.theme}>
                    <div className="grid grid-cols-3 gap-2">
                       {Object.keys(THEMES).filter(k=>k!=='birthday').map(k => (
                         <button key={k} onClick={()=>setUser({...user, theme:k})} 
                                 className={`py-3 rounded-xl border text-xs font-bold transition-all ${user.theme===k?'bg-white text-black border-white':'border-white/10 text-white/40'}`}
                                 style={{color: user.theme===k ? '#000' : THEMES[k].accent}}>
                            {THEMES[k].name}
                         </button>
                       ))}
                    </div>
                  </SettingSection>

                  <SettingSection title={txt.design}>
                    <div className="grid grid-cols-2 gap-2">
                       {['galaxy','grid'].map(d => (
                         <button key={d} onClick={()=>setUser({...user, design:d})} className={`py-3 rounded-xl border text-xs uppercase font-bold transition-all ${user.design===d?'bg-white text-black border-white':'border-white/10 text-white/40'}`}>{d}</button>
                       ))}
                    </div>
                  </SettingSection>
                  
                  <button onClick={()=>{localStorage.removeItem(STORAGE_KEY); window.location.reload()}} className="w-full mt-8 py-4 text-red-400 font-bold bg-red-500/10 rounded-xl hover:bg-red-500/20 transition-colors text-sm uppercase tracking-widest">{txt.reset}</button>
               </div>
            </div>
          )}
        </div>
      );
    }

    // --- SUB-COMPONENTS ---
    function Setup({onSave, t}) {
       const [n, sn] = useState("");
       const [d, sd] = useState("");
       return (
         <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-black relative overflow-hidden">
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_#222_0%,_#000_100%)]"></div>
            <div className="relative z-10 w-full max-w-sm text-center">
               <div className="w-20 h-20 bg-white text-black rounded-[2rem] mx-auto mb-6 flex items-center justify-center text-4xl shadow-[0_0_50px_rgba(255,255,255,0.2)]">‚è≥</div>
               <h1 className="text-3xl font-bold mb-2 tracking-tight">{t.welcome}</h1>
               <p className="text-white/50 mb-10">{t.sub}</p>
               <div className="glass-panel p-8 rounded-[2rem] space-y-4 text-left">
                  <div>
                    <label className="text-[10px] uppercase font-bold tracking-widest opacity-50 ml-1">{t.setup_name}</label>
                    <input className="w-full bg-white/5 border border-white/10 p-4 rounded-xl mt-2 text-white outline-none focus:border-white/50 focus:bg-white/10 transition-all font-bold placeholder-white/20" onChange={e=>sn(e.target.value)} />
                  </div>
                  <div>
                    <label className="text-[10px] uppercase font-bold tracking-widest opacity-50 ml-1">{t.setup_dob}</label>
                    <input type="date" className="w-full bg-white/5 border border-white/10 p-4 rounded-xl mt-2 text-white outline-none focus:border-white/50 focus:bg-white/10 transition-all" onChange={e=>sd(e.target.value)} />
                  </div>
                  <button onClick={()=>n&&d&&onSave({name:n, dob:d, lang:'es', theme:'nebula', design:'galaxy'})} disabled={!n||!d} className="w-full py-4 bg-white text-black font-bold rounded-xl mt-4 active:scale-95 transition-all disabled:opacity-50">{t.btn_start}</button>
               </div>
            </div>
         </div>
       );
    }

    const StatCard = ({icon, val, label}) => (
      <div className="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center text-center hover:bg-white/5 transition-colors">
         <div className="text-xl mb-1">{icon}</div>
         <div className="text-lg font-bold leading-none tracking-tight">{val}</div>
         <div className="text-[9px] uppercase tracking-wider opacity-40 mt-1">{label}</div>
      </div>
    );

    const ContextCard = ({title, text, theme}) => (
      <div className="glass-panel p-5 rounded-2xl border-l-2" style={{borderLeftColor: theme.accent}}>
         <h4 className="text-[10px] uppercase font-bold tracking-widest opacity-40 mb-1">{title}</h4>
         <p className="text-sm font-medium opacity-80 leading-relaxed">{text}</p>
      </div>
    );

    const SettingSection = ({title, children}) => (
      <div className="mb-6">
        <h3 className="text-[10px] uppercase font-bold tracking-widest opacity-40 mb-3">{title}</h3>
        {children}
      </div>
    );

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
